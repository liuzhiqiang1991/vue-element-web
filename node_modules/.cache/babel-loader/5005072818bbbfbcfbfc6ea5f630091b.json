{"remainingRequest":"/Users/root1/Desktop/学习/vue-element-web/node_modules/babel-loader/lib/index.js!/Users/root1/Desktop/学习/vue-element-web/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/root1/Desktop/学习/vue-element-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/root1/Desktop/学习/vue-element-web/src/components/EbookUpload/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/root1/Desktop/学习/vue-element-web/src/components/EbookUpload/index.vue","mtime":1621475710000},{"path":"/Users/root1/Desktop/学习/vue-element-web/node_modules/cache-loader/dist/cjs.js","mtime":1621475682000},{"path":"/Users/root1/Desktop/学习/vue-element-web/node_modules/babel-loader/lib/index.js","mtime":1621475680000},{"path":"/Users/root1/Desktop/学习/vue-element-web/node_modules/cache-loader/dist/cjs.js","mtime":1621475682000},{"path":"/Users/root1/Desktop/学习/vue-element-web/node_modules/vue-loader/lib/index.js","mtime":1621475707000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KaW1wb3J0IHsgZ2V0VG9rZW4gfSBmcm9tICcuLi8uLi91dGlscy9hdXRoJzsKZXhwb3J0IGRlZmF1bHQgewogIHByb3BzOiB7CiAgICBmaWxlTGlzdDogewogICAgICB0eXBlOiBBcnJheSwKICAgICAgZGVmYXVsdDogZnVuY3Rpb24gX2RlZmF1bHQoKSB7CiAgICAgICAgcmV0dXJuIFtdOwogICAgICB9CiAgICB9LAogICAgZGlzYWJsZWQ6IHsKICAgICAgdHlwZTogQm9vbGVhbiwKICAgICAgZGVmYXVsdDogZmFsc2UKICAgIH0KICB9LAogIGRhdGE6IGZ1bmN0aW9uIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBhY3Rpb246ICIiLmNvbmNhdChwcm9jZXNzLmVudi5WVUVfQVBQX0JBU0VfQVBJLCAiYm9vay91cGxvYWQiKQogICAgfTsKICB9LAogIGNvbXB1dGVkOiB7CiAgICBoZWFkZXJzOiBmdW5jdGlvbiBoZWFkZXJzKCkgewogICAgICByZXR1cm4gewogICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQoZ2V0VG9rZW4oKSkKICAgICAgfTsKICAgIH0KICB9LAogIG1ldGhvZHM6IHsKICAgIGJlZm9yZVVwbG9hZDogZnVuY3Rpb24gYmVmb3JlVXBsb2FkKGZpbGUpIHsKICAgICAgY29uc29sZS5sb2coZmlsZSk7IC8vIGFsZXJ0KGBCZWFyZXIgJHtnZXRUb2tlbigpfWApCgogICAgICB0aGlzLiRlbWl0KCdiZWZvcmVVcGxvYWQnLCBmaWxlKTsKICAgIH0sCiAgICBvblN1Y2Nlc3M6IGZ1bmN0aW9uIG9uU3VjY2VzcyhyZXNwb25zZSwgZmlsZSkgewogICAgICBjb25zb2xlLmxvZyhyZXNwb25zZSwgZmlsZSk7CiAgICAgIHZhciBjb2RlID0gcmVzcG9uc2UuY29kZSwKICAgICAgICAgIG1zZyA9IHJlc3BvbnNlLm1zZzsKCiAgICAgIGlmIChjb2RlID09PSAwKSB7CiAgICAgICAgdGhpcy4kbWVzc2FnZSh7CiAgICAgICAgICBtZXNzYWdlOiBtc2csCiAgICAgICAgICB0eXBlOiAnc3VjY2VzcycKICAgICAgICB9KTsKICAgICAgICB0aGlzLiRlbWl0KCdvblN1Y2Nlc3MnLCBmaWxlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLiRtZXNzYWdlKHsKICAgICAgICAgIG1lc3NhZ2U6IG1zZyAmJiAiXHU0RTBBXHU0RjIwXHU1OTMxXHU4RDI1XHVGRjBDXHU1OTMxXHU4RDI1XHU1MzlGXHU1NkUwXHVGRjFBIi5jb25jYXQobXNnKSB8fCAn5LiK5Lyg5aSx6LSlJywKICAgICAgICAgIHR5cGU6ICdlcnJvcicKICAgICAgICB9KTsKICAgICAgICB0aGlzLiRlbWl0KCdvbkVycm9yJywgZmlsZSk7CiAgICAgIH0KICAgIH0sCiAgICBvbkVycm9yOiBmdW5jdGlvbiBvbkVycm9yKGVycikgewogICAgICBjb25zb2xlLmxvZyhlcnIpOwogICAgICB2YXIgZXJyTXNnID0gZXJyLm1lc3NhZ2UgJiYgSlNPTi5wYXJzZShlcnIubWVzc2FnZSk7CiAgICAgIHRoaXMuJG1lc3NhZ2UoewogICAgICAgIG1lc3NhZ2U6IGVyck1zZyAmJiBlcnJNc2cubXNnICYmICJcdTRFMEFcdTRGMjBcdTU5MzFcdThEMjVcdUZGMENcdTU5MzFcdThEMjVcdTUzOUZcdTU2RTBcdUZGMUEiLmNvbmNhdChlcnJNc2cubXNnKSB8fCAn5LiK5Lyg5aSx6LSlJywKICAgICAgICB0eXBlOiAnZXJyb3InCiAgICAgIH0pOwogICAgfSwKICAgIG9uUmVtb3ZlOiBmdW5jdGlvbiBvblJlbW92ZSgpIHsKICAgICAgdGhpcy4kbWVzc2FnZSh7CiAgICAgICAgbWVzc2FnZTogJ+eUteinhuS5puWIoOmZpOaIkOWKnycsCiAgICAgICAgdHlwZTogJ3N1Y2Nlc3MnCiAgICAgIH0pOwogICAgICB0aGlzLiRlbWl0KCdvblJlbW92ZScpOwogICAgfSwKICAgIG9uRXhjZWVkOiBmdW5jdGlvbiBvbkV4Y2VlZCgpIHsKICAgICAgdGhpcy4kbWVzc2FnZSh7CiAgICAgICAgbWVzc2FnZTogJ+avj+asoeWPquiDveS4iuS8oOS4gOacrOeUteWtkOS5picsCiAgICAgICAgdHlwZTogJ3dhcm5pbmcnCiAgICAgIH0pOwogICAgfQogIH0KfTs="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8BA,SAAA,QAAA,QAAA,kBAAA;AACA,eAAA;AACA,EAAA,KAAA,EAAA;AACA,IAAA,QAAA,EAAA;AACA,MAAA,IAAA,EAAA,KADA;AAEA,MAAA,OAFA,sBAEA;AACA,eAAA,EAAA;AACA;AAJA,KADA;AAOA,IAAA,QAAA,EAAA;AACA,MAAA,IAAA,EAAA,OADA;AAEA,MAAA,OAAA,EAAA;AAFA;AAPA,GADA;AAaA,EAAA,IAbA,kBAaA;AACA,WAAA;AACA,MAAA,MAAA,YAAA,OAAA,CAAA,GAAA,CAAA,gBAAA;AADA,KAAA;AAGA,GAjBA;AAkBA,EAAA,QAAA,EAAA;AACA,IAAA,OADA,qBACA;AACA,aAAA;AACA,QAAA,aAAA,mBAAA,QAAA,EAAA;AADA,OAAA;AAGA;AALA,GAlBA;AAyBA,EAAA,OAAA,EAAA;AACA,IAAA,YADA,wBACA,IADA,EACA;AACA,MAAA,OAAA,CAAA,GAAA,CAAA,IAAA,EADA,CAEA;;AACA,WAAA,KAAA,CAAA,cAAA,EAAA,IAAA;AACA,KALA;AAMA,IAAA,SANA,qBAMA,QANA,EAMA,IANA,EAMA;AACA,MAAA,OAAA,CAAA,GAAA,CAAA,QAAA,EAAA,IAAA;AACA,UAAA,IAAA,GAAA,QAAA,CAAA,IAAA;AAAA,UAAA,GAAA,GAAA,QAAA,CAAA,GAAA;;AACA,UAAA,IAAA,KAAA,CAAA,EAAA;AACA,aAAA,QAAA,CAAA;AACA,UAAA,OAAA,EAAA,GADA;AAEA,UAAA,IAAA,EAAA;AAFA,SAAA;AAIA,aAAA,KAAA,CAAA,WAAA,EAAA,IAAA;AACA,OANA,MAMA;AACA,aAAA,QAAA,CAAA;AACA,UAAA,OAAA,EAAA,GAAA,0EAAA,GAAA,CAAA,IAAA,MADA;AAEA,UAAA,IAAA,EAAA;AAFA,SAAA;AAIA,aAAA,KAAA,CAAA,SAAA,EAAA,IAAA;AACA;AACA,KAtBA;AAuBA,IAAA,OAvBA,mBAuBA,GAvBA,EAuBA;AACA,MAAA,OAAA,CAAA,GAAA,CAAA,GAAA;AACA,UAAA,MAAA,GAAA,GAAA,CAAA,OAAA,IAAA,IAAA,CAAA,KAAA,CAAA,GAAA,CAAA,OAAA,CAAA;AACA,WAAA,QAAA,CAAA;AACA,QAAA,OAAA,EAAA,MAAA,IAAA,MAAA,CAAA,GAAA,0EAAA,MAAA,CAAA,GAAA,CAAA,IAAA,MADA;AAEA,QAAA,IAAA,EAAA;AAFA,OAAA;AAIA,KA9BA;AA+BA,IAAA,QA/BA,sBA+BA;AACA,WAAA,QAAA,CAAA;AACA,QAAA,OAAA,EAAA,SADA;AAEA,QAAA,IAAA,EAAA;AAFA,OAAA;AAIA,WAAA,KAAA,CAAA,UAAA;AACA,KArCA;AAsCA,IAAA,QAtCA,sBAsCA;AACA,WAAA,QAAA,CAAA;AACA,QAAA,OAAA,EAAA,aADA;AAEA,QAAA,IAAA,EAAA;AAFA,OAAA;AAIA;AA3CA;AAzBA,CAAA","sourcesContent":["<template>\n  <div class=\"upload-container\">\n    <el-upload\n      :action=\"action\"\n      :headers=\"headers\"\n      :multiple=\"false\"\n      :limit=\"1\"\n      :before-upload=\"beforeUpload\"\n      :on-success=\"onSuccess\"\n      :on-error=\"onError\"\n      :on-remove=\"onRemove\"\n      :file-list=\"fileList\"\n      :on-exceed=\"onExceed\"\n      :disabled=\"disabled\"\n      drag\n      show-file-list\n      accept=\"application/epub+zip\"\n      class=\"image-upload\"\n    >\n      <i class=\"el-icon-upload\" />\n      <div v-if=\"fileList.length === 0\" class=\"el-upload__text\">\n        请将电子书拖入或<em>点击上传</em>\n      </div>\n      <div v-else class=\"el-upload__text\">\n        图书已上传\n      </div>\n    </el-upload>\n  </div>\n</template>\n<script>\nimport { getToken } from '../../utils/auth'\nexport default {\n  props: {\n    fileList: {\n      type: Array,\n      default() {\n        return []\n      }\n    },\n    disabled: {\n      type: Boolean,\n      default: false\n    }\n  },\n  data() {\n    return {\n      action: `${process.env.VUE_APP_BASE_API}book/upload`\n    }\n  },\n  computed: {\n    headers() {\n      return {\n        Authorization: `Bearer ${getToken()}`\n      }\n    }\n  },\n  methods: {\n    beforeUpload(file) {\n      console.log(file)\n      // alert(`Bearer ${getToken()}`)\n      this.$emit('beforeUpload', file)\n    },\n    onSuccess(response, file) {\n      console.log(response, file)\n      const { code, msg } = response\n      if (code === 0) {\n        this.$message({\n          message: msg,\n          type: 'success'\n        })\n        this.$emit('onSuccess', file)\n      } else {\n        this.$message({\n          message: (msg && `上传失败，失败原因：${msg}`) || '上传失败',\n          type: 'error'\n        })\n        this.$emit('onError', file)\n      }\n    },\n    onError(err) {\n      console.log(err)\n      const errMsg = err.message && JSON.parse(err.message)\n      this.$message({\n        message: (errMsg && errMsg.msg && `上传失败，失败原因：${errMsg.msg}`) || '上传失败',\n        type: 'error'\n      })\n    },\n    onRemove() {\n      this.$message({\n        message: '电视书删除成功',\n        type: 'success'\n      })\n      this.$emit('onRemove')\n    },\n    onExceed() {\n      this.$message({\n        message: '每次只能上传一本电子书',\n        type: 'warning'\n      })\n    }\n  }\n}\n</script>\n<style lang=\"scss\" scoped></style>\n"],"sourceRoot":"src/components/EbookUpload"}]}