{"remainingRequest":"/Users/root1/Desktop/学习/vue-element-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/root1/Desktop/学习/vue-element-web/src/components/EbookUpload/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/root1/Desktop/学习/vue-element-web/src/components/EbookUpload/index.vue","mtime":1621169398000},{"path":"/Users/root1/Desktop/学习/vue-element-web/node_modules/cache-loader/dist/cjs.js","mtime":1621132353000},{"path":"/Users/root1/Desktop/学习/vue-element-web/node_modules/babel-loader/lib/index.js","mtime":1621132352000},{"path":"/Users/root1/Desktop/学习/vue-element-web/node_modules/cache-loader/dist/cjs.js","mtime":1621132353000},{"path":"/Users/root1/Desktop/学习/vue-element-web/node_modules/vue-loader/lib/index.js","mtime":1621132357000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IGdldFRva2VuIH0gZnJvbSAnLi4vLi4vdXRpbHMvYXV0aCcKZXhwb3J0IGRlZmF1bHQgewogIHByb3BzOiB7CiAgICBmaWxlTGlzdDogewogICAgICB0eXBlOiBBcnJheSwKICAgICAgZGVmYXVsdCgpIHsKICAgICAgICByZXR1cm4gW10KICAgICAgfQogICAgfSwKICAgIGRpc2FibGVkOiB7CiAgICAgIHR5cGU6IEJvb2xlYW4sCiAgICAgIGRlZmF1bHQ6IGZhbHNlCiAgICB9CiAgfSwKICBjb21wdXRlZDogewogICAgaGVhZGVycygpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7Z2V0VG9rZW4oKX1gCiAgICAgIH0KICAgIH0KICB9LAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBhY3Rpb246IGAke3Byb2Nlc3MuZW52LlZVRV9BUFBfQkFTRV9BUEl9Ym9vay91cGxvYWRgCiAgICB9CiAgfSwKICBtZXRob2RzOiB7CiAgICBiZWZvcmVVcGxvYWQoZmlsZSkgewogICAgICBjb25zb2xlLmxvZyhmaWxlKQogICAgICAvL2FsZXJ0KGBCZWFyZXIgJHtnZXRUb2tlbigpfWApCiAgICAgIHRoaXMuJGVtaXQoJ2JlZm9yZVVwbG9hZCcsIGZpbGUpCiAgICB9LAogICAgb25TdWNjZXNzKHJlc3BvbnNlLCBmaWxlKSB7CiAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlLCBmaWxlKQogICAgICBjb25zdCB7IGNvZGUsIG1zZyB9ID0gcmVzcG9uc2UKICAgICAgaWYoY29kZSA9PT0gMCkgewogICAgICAgIHRoaXMuJG1lc3NhZ2UoewogICAgICAgICAgbWVzc2FnZTogbXNnLAogICAgICAgICAgdHlwZTogJ3N1Y2Nlc3MnCiAgICAgICAgfSkKICAgICAgICB0aGlzLiRlbWl0KCdvblN1Y2Nlc3MnLCBmaWxlKQogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuJG1lc3NhZ2UoewogICAgICAgICAgbWVzc2FnZTogKG1zZyAmJiBg5LiK5Lyg5aSx6LSl77yM5aSx6LSl5Y6f5Zug77yaJHttc2d9YCkgfHwgJ+S4iuS8oOWksei0pScsCiAgICAgICAgICB0eXBlOiAnZXJyb3InCiAgICAgICAgfSkKICAgICAgICB0aGlzLiRlbWl0KCdvbkVycm9yJywgZmlsZSkKICAgICAgfQogICAgfSwKICAgIG9uRXJyb3IoZXJyKSB7CiAgICAgIGNvbnNvbGUubG9nKGVycikKICAgICAgY29uc3QgZXJyTXNnID0gZXJyLm1lc3NhZ2UgJiYgSlNPTi5wYXJzZShlcnIubWVzc2FnZSkKICAgICAgdGhpcy4kbWVzc2FnZSh7CiAgICAgICAgbWVzc2FnZTogKGVyck1zZyAmJiBlcnJNc2cubXNnICYmIGDkuIrkvKDlpLHotKXvvIzlpLHotKXljp/lm6DvvJoke2Vyck1zZy5tc2d9YCkgfHwgJ+S4iuS8oOWksei0pScsCiAgICAgICAgdHlwZTogJ2Vycm9yJwogICAgICB9KQogICAgfSwKICAgIG9uUmVtb3ZlKCkgewogICAgICB0aGlzLiRtZXNzYWdlKHsKICAgICAgICBtZXNzYWdlOiAn55S16KeG5Lmm5Yig6Zmk5oiQ5YqfJywKICAgICAgICB0eXBlOiAnc3VjY2VzcycKICAgICAgfSkKICAgICAgdGhpcy4kZW1pdCgnb25SZW1vdmUnKQogICAgfSwKICAgIG9uRXhjZWVkKCkgewogICAgICB0aGlzLiRtZXNzYWdlKHsKICAgICAgICBtZXNzYWdlOiAn5q+P5qyh5Y+q6IO95LiK5Lyg5LiA5pys55S15a2Q5LmmJywKICAgICAgICB0eXBlOiAnd2FybmluZycKICAgICAgfSkKICAgIH0KICB9Cn0K"},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/components/EbookUpload","sourcesContent":["<template>\n  <div class=\"upload-container\">\n    <el-upload\n      :action=\"action\"\n      :headers=\"headers\"\n      :multiple=\"false\"\n      :limit=\"1\"\n      :before-upload=\"beforeUpload\"\n      :on-success=\"onSuccess\"\n      :on-error=\"onError\"\n      :on-remove=\"onRemove\"\n      :file-list=\"fileList\"\n      :on-exceed=\"onExceed\"\n      :disabled=\"disabled\"\n      drag\n      show-file-list\n      accept=\"application/epub+zip\"\n      class=\"image-upload\"\n    >\n      <i class=\"el-icon-upload\" />\n      <div class=\"el-upload__text\" v-if=\"fileList.length === 0\">\n        请将电子书拖入或<em>点击上传</em>\n      </div>\n      <div class=\"el-upload__text\" v-else>\n        图书已上传\n      </div>\n    </el-upload>\n  </div>\n</template>\n<script>\nimport { getToken } from '../../utils/auth'\nexport default {\n  props: {\n    fileList: {\n      type: Array,\n      default() {\n        return []\n      }\n    },\n    disabled: {\n      type: Boolean,\n      default: false\n    }\n  },\n  computed: {\n    headers() {\n      return {\n        Authorization: `Bearer ${getToken()}`\n      }\n    }\n  },\n  data() {\n    return {\n      action: `${process.env.VUE_APP_BASE_API}book/upload`\n    }\n  },\n  methods: {\n    beforeUpload(file) {\n      console.log(file)\n      //alert(`Bearer ${getToken()}`)\n      this.$emit('beforeUpload', file)\n    },\n    onSuccess(response, file) {\n      console.log(response, file)\n      const { code, msg } = response\n      if(code === 0) {\n        this.$message({\n          message: msg,\n          type: 'success'\n        })\n        this.$emit('onSuccess', file)\n      } else {\n        this.$message({\n          message: (msg && `上传失败，失败原因：${msg}`) || '上传失败',\n          type: 'error'\n        })\n        this.$emit('onError', file)\n      }\n    },\n    onError(err) {\n      console.log(err)\n      const errMsg = err.message && JSON.parse(err.message)\n      this.$message({\n        message: (errMsg && errMsg.msg && `上传失败，失败原因：${errMsg.msg}`) || '上传失败',\n        type: 'error'\n      })\n    },\n    onRemove() {\n      this.$message({\n        message: '电视书删除成功',\n        type: 'success'\n      })\n      this.$emit('onRemove')\n    },\n    onExceed() {\n      this.$message({\n        message: '每次只能上传一本电子书',\n        type: 'warning'\n      })\n    }\n  }\n}\n</script>\n<style lang=\"scss\" scoped></style>\n"]}]}