{"remainingRequest":"/Users/root1/Desktop/学习/vue-element-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/root1/Desktop/学习/vue-element-web/src/components/EbookUpload/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/root1/Desktop/学习/vue-element-web/src/components/EbookUpload/index.vue","mtime":1621391380000},{"path":"/Users/root1/Desktop/学习/vue-element-web/node_modules/cache-loader/dist/cjs.js","mtime":1621391372000},{"path":"/Users/root1/Desktop/学习/vue-element-web/node_modules/babel-loader/lib/index.js","mtime":1621391371000},{"path":"/Users/root1/Desktop/学习/vue-element-web/node_modules/cache-loader/dist/cjs.js","mtime":1621391372000},{"path":"/Users/root1/Desktop/学习/vue-element-web/node_modules/vue-loader/lib/index.js","mtime":1621391379000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IGdldFRva2VuIH0gZnJvbSAnLi4vLi4vdXRpbHMvYXV0aCcKZXhwb3J0IGRlZmF1bHQgewogIHByb3BzOiB7CiAgICBmaWxlTGlzdDogewogICAgICB0eXBlOiBBcnJheSwKICAgICAgZGVmYXVsdCgpIHsKICAgICAgICByZXR1cm4gW10KICAgICAgfQogICAgfSwKICAgIGRpc2FibGVkOiB7CiAgICAgIHR5cGU6IEJvb2xlYW4sCiAgICAgIGRlZmF1bHQ6IGZhbHNlCiAgICB9CiAgfSwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgYWN0aW9uOiBgJHtwcm9jZXNzLmVudi5WVUVfQVBQX0JBU0VfQVBJfWJvb2svdXBsb2FkYAogICAgfQogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIGhlYWRlcnMoKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke2dldFRva2VuKCl9YAogICAgICB9CiAgICB9CiAgfSwKICBtZXRob2RzOiB7CiAgICBiZWZvcmVVcGxvYWQoZmlsZSkgewogICAgICBjb25zb2xlLmxvZyhmaWxlKQogICAgICAvLyBhbGVydChgQmVhcmVyICR7Z2V0VG9rZW4oKX1gKQogICAgICB0aGlzLiRlbWl0KCdiZWZvcmVVcGxvYWQnLCBmaWxlKQogICAgfSwKICAgIG9uU3VjY2VzcyhyZXNwb25zZSwgZmlsZSkgewogICAgICBjb25zb2xlLmxvZyhyZXNwb25zZSwgZmlsZSkKICAgICAgY29uc3QgeyBjb2RlLCBtc2cgfSA9IHJlc3BvbnNlCiAgICAgIGlmIChjb2RlID09PSAwKSB7CiAgICAgICAgdGhpcy4kbWVzc2FnZSh7CiAgICAgICAgICBtZXNzYWdlOiBtc2csCiAgICAgICAgICB0eXBlOiAnc3VjY2VzcycKICAgICAgICB9KQogICAgICAgIHRoaXMuJGVtaXQoJ29uU3VjY2VzcycsIGZpbGUpCiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy4kbWVzc2FnZSh7CiAgICAgICAgICBtZXNzYWdlOiAobXNnICYmIGDkuIrkvKDlpLHotKXvvIzlpLHotKXljp/lm6DvvJoke21zZ31gKSB8fCAn5LiK5Lyg5aSx6LSlJywKICAgICAgICAgIHR5cGU6ICdlcnJvcicKICAgICAgICB9KQogICAgICAgIHRoaXMuJGVtaXQoJ29uRXJyb3InLCBmaWxlKQogICAgICB9CiAgICB9LAogICAgb25FcnJvcihlcnIpIHsKICAgICAgY29uc29sZS5sb2coZXJyKQogICAgICBjb25zdCBlcnJNc2cgPSBlcnIubWVzc2FnZSAmJiBKU09OLnBhcnNlKGVyci5tZXNzYWdlKQogICAgICB0aGlzLiRtZXNzYWdlKHsKICAgICAgICBtZXNzYWdlOiAoZXJyTXNnICYmIGVyck1zZy5tc2cgJiYgYOS4iuS8oOWksei0pe+8jOWksei0peWOn+WboO+8miR7ZXJyTXNnLm1zZ31gKSB8fCAn5LiK5Lyg5aSx6LSlJywKICAgICAgICB0eXBlOiAnZXJyb3InCiAgICAgIH0pCiAgICB9LAogICAgb25SZW1vdmUoKSB7CiAgICAgIHRoaXMuJG1lc3NhZ2UoewogICAgICAgIG1lc3NhZ2U6ICfnlLXop4bkuabliKDpmaTmiJDlip8nLAogICAgICAgIHR5cGU6ICdzdWNjZXNzJwogICAgICB9KQogICAgICB0aGlzLiRlbWl0KCdvblJlbW92ZScpCiAgICB9LAogICAgb25FeGNlZWQoKSB7CiAgICAgIHRoaXMuJG1lc3NhZ2UoewogICAgICAgIG1lc3NhZ2U6ICfmr4/mrKHlj6rog73kuIrkvKDkuIDmnKznlLXlrZDkuaYnLAogICAgICAgIHR5cGU6ICd3YXJuaW5nJwogICAgICB9KQogICAgfQogIH0KfQo="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/components/EbookUpload","sourcesContent":["<template>\n  <div class=\"upload-container\">\n    <el-upload\n      :action=\"action\"\n      :headers=\"headers\"\n      :multiple=\"false\"\n      :limit=\"1\"\n      :before-upload=\"beforeUpload\"\n      :on-success=\"onSuccess\"\n      :on-error=\"onError\"\n      :on-remove=\"onRemove\"\n      :file-list=\"fileList\"\n      :on-exceed=\"onExceed\"\n      :disabled=\"disabled\"\n      drag\n      show-file-list\n      accept=\"application/epub+zip\"\n      class=\"image-upload\"\n    >\n      <i class=\"el-icon-upload\" />\n      <div v-if=\"fileList.length === 0\" class=\"el-upload__text\">\n        请将电子书拖入或<em>点击上传</em>\n      </div>\n      <div v-else class=\"el-upload__text\">\n        图书已上传\n      </div>\n    </el-upload>\n  </div>\n</template>\n<script>\nimport { getToken } from '../../utils/auth'\nexport default {\n  props: {\n    fileList: {\n      type: Array,\n      default() {\n        return []\n      }\n    },\n    disabled: {\n      type: Boolean,\n      default: false\n    }\n  },\n  data() {\n    return {\n      action: `${process.env.VUE_APP_BASE_API}book/upload`\n    }\n  },\n  computed: {\n    headers() {\n      return {\n        Authorization: `Bearer ${getToken()}`\n      }\n    }\n  },\n  methods: {\n    beforeUpload(file) {\n      console.log(file)\n      // alert(`Bearer ${getToken()}`)\n      this.$emit('beforeUpload', file)\n    },\n    onSuccess(response, file) {\n      console.log(response, file)\n      const { code, msg } = response\n      if (code === 0) {\n        this.$message({\n          message: msg,\n          type: 'success'\n        })\n        this.$emit('onSuccess', file)\n      } else {\n        this.$message({\n          message: (msg && `上传失败，失败原因：${msg}`) || '上传失败',\n          type: 'error'\n        })\n        this.$emit('onError', file)\n      }\n    },\n    onError(err) {\n      console.log(err)\n      const errMsg = err.message && JSON.parse(err.message)\n      this.$message({\n        message: (errMsg && errMsg.msg && `上传失败，失败原因：${errMsg.msg}`) || '上传失败',\n        type: 'error'\n      })\n    },\n    onRemove() {\n      this.$message({\n        message: '电视书删除成功',\n        type: 'success'\n      })\n      this.$emit('onRemove')\n    },\n    onExceed() {\n      this.$message({\n        message: '每次只能上传一本电子书',\n        type: 'warning'\n      })\n    }\n  }\n}\n</script>\n<style lang=\"scss\" scoped></style>\n"]}]}